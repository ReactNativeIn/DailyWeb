<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.daily.www.product">

	<!-- 상품수 -->
	<select id="listTotalCount" parameterType="com.daily.common.util.Criteria" resultType="integer">
		<![CDATA[
			SELECT COUNT(*) 
			FROM product JOIN category 
			ON product.category_id = category.c_id 
			WHERE 1 = 1 AND 
		]]>
		<include refid = "pathName"/>
	</select>
	
	<!-- 상품목록 불러오기 (페이징) -->
	<select id="listPaging" parameterType="hashmap" resultType="com.daily.www.product.ProductVO">
		<![CDATA[
			SELECT product_id, p_name, p_explanation, p_price, p_enroll, p_sell, brd.category_id
			FROM (
				SELECT	product_id, p_name, p_explanation, p_price, p_enroll, p_sell, category_id, 
		]]>
		<include refid = "listMySQL"/>
		<![CDATA[
				FROM product JOIN category
				on product.category_id = category.c_id
				WHERE 
		]]>
		<include refid = "pathName"/>
		<![CDATA[
				) brd
			WHERE brd.rNUM BETWEEN #{perPageNum}*(#{page}-1) + 1 AND #{perPageNum}*(#{page}-1)+${perPageNum} 
			ORDER BY rNUM
		]]>
	</select>
	
	<!-- list 파라미터에서 공통으로 사용하는 부분 -->
	<sql id="listMySQL">
		<if test="list == null">
			ROW_NUMBER() OVER(ORDER BY product_id DESC) as rNUM 
		</if>
		<if test="list != null">
			<if test="list == 'popular'.toString()">
				ROW_NUMBER() OVER(ORDER BY p_sell DESC) as rNUM 
			</if>
			<if test="list == 'high'.toString()">
				ROW_NUMBER() OVER(ORDER BY p_price DESC) as rNUM 
			</if>
			<if test="list == 'low'.toString()">
				ROW_NUMBER() OVER(ORDER BY p_price) as rNUM 
			</if>
			<if test="list == 'new'.toString()">
				ROW_NUMBER() OVER(ORDER BY product_id DESC) as rNUM 
			</if>
		</if>
	</sql>
	
	
	
	<!-- name이 공통된 애들 -->
	<sql id="pathName">
		<if test="name == 'new'.toString()">
			c_name = "New" 
		</if>
		<if test="name == 'unisex'.toString()">
			c_name = "남녀공용"
		</if>
	</sql>
	
	
</mapper>